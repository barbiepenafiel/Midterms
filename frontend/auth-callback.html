<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authenticating... - Oursfolio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .container {
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            margin: 0 auto 1.5rem;
            border: 4px solid rgba(236, 72, 153, 0.2);
            border-top-color: #ec4899;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #ec4899, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        p {
            color: #9ca3af;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <h1>Authenticating with Google</h1>
        <p>Please wait while we complete your sign-in...</p>
    </div>
    
    <script>
        // Parse OAuth response from URL hash
        function parseHash() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            return {
                accessToken: params.get('access_token'),
                idToken: params.get('id_token'),
                expiresIn: params.get('expires_in'),
                tokenType: params.get('token_type'),
                error: params.get('error')
            };
        }
        
        // Handle OAuth callback
        const oauthResponse = parseHash();
        
        if (oauthResponse.error) {
            // Handle error
            alert('Google Sign-In Error: ' + oauthResponse.error);
            window.location.href = 'landing.html';
        } else if (oauthResponse.idToken) {
            try {
                // Decode JWT token
                const tokenParts = oauthResponse.idToken.split('.');
                const payload = JSON.parse(atob(tokenParts[1]));
                
                // Store user info
                sessionStorage.setItem('google_auth_email', payload.email);
                sessionStorage.setItem('google_auth_name', payload.name || payload.email);
                sessionStorage.setItem('google_auth_picture', payload.picture || '');
                sessionStorage.setItem('google_auth_token', oauthResponse.accessToken);
                sessionStorage.setItem('google_auth_complete', 'true');
                
                // Redirect back to landing page
                setTimeout(() => {
                    window.location.href = 'landing.html';
                }, 500);
                
            } catch (error) {
                console.error('Error parsing token:', error);
                alert('Authentication failed. Please try again.');
                window.location.href = 'landing.html';
            }
        } else {
            // No token found
            alert('Authentication incomplete. Please try again.');
            window.location.href = 'landing.html';
        }
    </script>
</body>
</html>
